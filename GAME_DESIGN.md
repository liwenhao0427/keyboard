# Keyboard Warrior vs. Trolls (Potato Edition) - Game Design Document

## 1. é¡¹ç›®æ¦‚å†µ
è¿™æ˜¯ä¸€ä¸ªç»“åˆäº† **èƒŒåŒ…ç®¡ç† (Inventory Management)** å’Œ **å¡”é˜² (Tower Defense)** å…ƒç´ çš„ Rogue-lite ç½‘é¡µæ¸¸æˆã€‚çŽ©å®¶é€šè¿‡åœ¨ç½‘æ ¼ï¼ˆå¼¹è¯èˆ±ï¼‰ä¸­æ•´ç†ä¸åŒç±»åž‹çš„ "Emoji å¼¹è¯"ï¼Œæ¥æŠµå¾¡ä¸€æ³¢åˆä¸€æ³¢çš„ç½‘ç»œæ°´å†›ï¼ˆTrollsï¼‰ã€‚

**æž¶æž„æŠ€æœ¯æ ˆ:**
*   **å‰ç«¯æ¡†æž¶**: React 18
*   **çŠ¶æ€ç®¡ç†**: Zustand
*   **æ‹–æ‹½äº¤äº’**: @dnd-kit
*   **æ¸²æŸ“å¼•æ“Ž**: HTML5 Canvas (åŽŸç”Ÿ 2D Context)
*   **æ ·å¼**: Tailwind CSS

---

## 2. æ ¸å¿ƒæœºåˆ¶

### 2.1 å¼¹è¯èˆ± (Ammo Bay)
*   **æœºåˆ¶**: æ¸¸æˆå·¦ä¾§æ˜¯ä¸€ä¸ª 5è¡Œ x Nåˆ— çš„å­˜å‚¨åŒºã€‚
*   **Firing Logic**: 
    *   æ¯ä¸€è¡Œä»£è¡¨ä¸€ä¸ªç‹¬ç«‹çš„å‘å°„é˜Ÿåˆ—ã€‚
    *   æ¯ä¸ªæ ¼å­é‡Œçš„å¼¹è¯ï¼ˆAmmoï¼‰éƒ½æœ‰ç‹¬ç«‹çš„å†·å´æ—¶é—´ï¼ˆCooldownï¼‰ã€‚
    *   å¼¹è¯æŒ‰ç…§ä»Žå·¦åˆ°å³çš„é¡ºåºï¼Œä¸€æ—¦å†·å´å®Œæ¯•å³åˆ»å‘å°„ã€‚
*   **ç­–ç•¥**: çŽ©å®¶éœ€è¦æƒè¡¡æ”¾ç½®é«˜å°„é€Ÿä½Žä¼¤å®³çš„æ­¦å™¨ï¼Œè¿˜æ˜¯é•¿å†·å´é«˜çˆ†å‘çš„æ­¦å™¨ã€‚

### 2.2 æˆ˜æ–— (Combat Phase)
*   **æ•Œäºº**: ä»Žå±å¹•å³ä¾§ç”Ÿæˆï¼Œå‘å·¦ä¾§çš„ "é˜²çº¿" (Defense Line) ç§»åŠ¨ã€‚
*   **ä¼¤å®³åˆ¤å®š**: 
    *   å¦‚æžœæ•Œäººè§¦ç¢°é˜²çº¿ï¼ŒçŽ©å®¶æ‰£é™¤ HPã€‚
    *   å¦‚æžœçŽ©å®¶ HP å½’é›¶ï¼Œæ¸¸æˆç»“æŸã€‚
*   **å¼¹é“å­¦**:
    *   **Linear**: ç›´çº¿é£žè¡Œ (å¦‚æ‰‹æžª)ã€‚
    *   **Pierce**: ç©¿é€ (å¦‚éœ°å¼¹æžª)ã€‚
    *   **Homing**: è¿½è¸ªæœ€è¿‘æ•Œäºº (å¦‚é­”æ³•)ã€‚
    *   **Engineering**: åœ¨åœºä¸Šç”Ÿæˆç‚®å°æˆ–åœ°é›·ã€‚

### 2.3 ç»æµŽä¸Žæˆé•¿
*   **é‡‘å¸ (Gold)**: å‡»æ€æ•ŒäººèŽ·å¾—ï¼Œç”¨äºŽåœ¨å•†åº—è´­ä¹°æ–°å¼¹è¯æˆ–é“å…·ã€‚
*   **ç»éªŒ (XP)**: å‡»æ€æ•ŒäººæŽ‰è½ï¼Œæ‹¾å–åŽå‡çº§ã€‚
*   **å‡çº§ (Level Up)**: æ¯æ¬¡å‡çº§ä»Ž 3 ä¸ªéšæœºå±žæ€§åŠ æˆä¸­é€‰ 1 ä¸ªã€‚

---

## 3. æ•°å€¼ä¸Žå…¬å¼ (Formulas)

### 3.1 ä¼¤å®³è®¡ç®—
$$
\text{FinalDamage} = (\text{BaseDmg} + \text{FlatBonus}) \times (1 + \frac{\text{DamagePercent}}{100})
$$
*   `FlatBonus` æ¥æº: 
    *   è¿‘æˆ˜æ­¦å™¨ (MELEE) å—ç›ŠäºŽ `meleeDmg`
    *   è¿œç¨‹æ­¦å™¨ (RANGED) å—ç›ŠäºŽ `rangedDmg`
    *   é­”æ³•æ­¦å™¨ (MAGIC) å—ç›ŠäºŽ `elementalDmg`
    *   å·¥ç¨‹æ­¦å™¨ (ENGINEERING) å—ç›ŠäºŽ `engineering`
*   æš´å‡»åˆ¤å®š: ç‹¬ç«‹éšæœº `critChance`ï¼Œå€çŽ‡ä¸º `critDamage` (é»˜è®¤ 1.5x)ã€‚

### 3.2 æ”»å‡»é€Ÿåº¦
$$
\text{RealCooldown} = \frac{\text{BaseCooldown}}{1 + \frac{\text{AttackSpeed}}{100}}
$$

### 3.3 é˜²å¾¡å…¬å¼
*   **æŠ¤ç”² (Armor)**: 
    *   è‹¥ Armor >= 0: $\text{Received} = \text{Raw} \times \frac{100}{100 + \text{Armor}}$
    *   è‹¥ Armor < 0: $\text{Received} = \text{Raw} \times (2 - \frac{100}{100 - \text{Armor}})$

---

## 4. æ•°æ®å­—å…¸ (Data Tables)

### 4.1 å±žæ€§å®šä¹‰ (PlayerStats)

| å±žæ€§ | ä»£ç å­—æ®µ | ä½œç”¨ |
| :--- | :--- | :--- |
| ç”Ÿå‘½å€¼ | `hp` / `maxHp` | ç”Ÿå­˜åŸºç¡€ |
| ç”Ÿå‘½å†ç”Ÿ | `hpRegen` | æ¯ 5 ç§’å›žå¤é‡ |
| ç”Ÿå‘½çªƒå– | `lifeSteal` | æ”»å‡»å‘½ä¸­æ—¶ 1HP å›žå¤æ¦‚çŽ‡ |
| ä¼¤å®³åŠ æˆ | `damagePercent` | å…¨å±€ç™¾åˆ†æ¯”å¢žä¼¤ |
| æ”»å‡»é€Ÿåº¦ | `attackSpeed` | å‡å°‘å†·å´æ—¶é—´ |
| æš´å‡»çŽ‡ | `critChance` | é€ æˆ 1.5x ä¼¤å®³çš„æ¦‚çŽ‡ |
| èŒƒå›´ | `range` | å¢žåŠ å°„ç¨‹ (åƒç´ ) |
| å·¥ç¨‹å­¦ | `engineering` | å¢žåŠ ç‚®å°ä¼¤å®³/å›žå¤é€Ÿåº¦ |
| å¹¸è¿ | `luck` | å½±å“å•†åº—åˆ·æ–°ç¨€æœ‰åº¦ |
| æ”¶èŽ· | `harvesting` | æ³¢æ¬¡ç»“æŸæ—¶èŽ·å¾—çš„é‡‘å¸/ç»éªŒ |

### 4.2 æ­¦å™¨åº“ (Weapon Pool - éƒ¨åˆ†ç¤ºä¾‹)

| åç§° | Emoji | ç±»åž‹ | Class | åŸºç¡€ä¼¤å®³ | CD | ç‰¹æ€§ |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| é‡æ‹³ | ðŸ‘Š | LINEAR | MELEE | 8 | 0.76s | é«˜å‡»é€€ |
| æ ‘æž | ðŸ¥¢ | LINEAR | MELEE | 8 | 1.25s | åŸºç¡€æ­¦å™¨ |
| æ‰‹æžª | ðŸ”« | LINEAR | RANGED | 12 | 1.20s | è¿œç¨‹å•ä½“ |
| éœ°å¼¹ | ðŸ’¥ | PIERCE | RANGED | 3 | 1.37s | å¤šå¼¹å¤´ç©¿é€ |
| é—ªç”µ | âš¡ | HOMING | MAGIC | 3 | 1.01s | è‡ªåŠ¨è¿½è¸ª |
| æ‰³æ‰‹ | ðŸ”§ | ENG | ENG | 12 | 1.74s | ç”Ÿæˆç‚®å° |

### 4.3 æ•Œäººå›¾é‰´ (Bestiary)

| ä»£å· | åç§° | Emoji | ç‰¹æ€§ |
| :--- | :--- | :--- | :--- |
| baby_alien | å¤–æ˜Ÿå¹¼å´½ | ðŸ‘¾ | åŸºç¡€è¿‘æˆ˜å•ä½ |
| chaser | è¿½é€è€… | ðŸ› | å¿«é€Ÿç§»åŠ¨ï¼Œè¡€é‡ä½Ž |
| spitter | å–·åè€… | ðŸ¡ | è¿œç¨‹æ”»å‡»å•ä½ |
| charger | å†²é”‹è€… | ðŸ— | è¡€é‡é«˜ï¼Œé€Ÿåº¦å¿« |
| loot_goblin| å¯»å®å“¥ | ðŸ’° | ä¸æ”»å‡»ï¼Œå‡»æ€æŽ‰è½å®ç®± |
| rhino | çŠ€ç‰› | ðŸ¦ | ç²¾è‹±æ€ªï¼Œå†²é”‹å¼¹å¹• |
| predator | æŽ é£Ÿè€… | â˜ ï¸ | æœ€ç»ˆBOSS |

---

## 5. é¡¹ç›®ç›®å½•ç»“æž„

```
/
â”œâ”€â”€ index.html          # å…¥å£ HTML
â”œâ”€â”€ index.tsx           # React å…¥å£
â”œâ”€â”€ App.tsx             # ä¸»å¸ƒå±€ä¸ŽçŠ¶æ€æŽ§åˆ¶
â”œâ”€â”€ constants.ts        # é™æ€æ•°æ® (æ­¦å™¨è¡¨ã€æ•Œäººè¡¨)
â”œâ”€â”€ types.ts            # TypeScript æŽ¥å£å®šä¹‰
â”œâ”€â”€ services/
â”‚   â””â”€â”€ GameEngine.ts   # æ ¸å¿ƒæ¸¸æˆå¾ªçŽ¯ (Canvas, Entity Update)
â”œâ”€â”€ store/
â”‚   â””â”€â”€ useGameStore.ts # Zustand å…¨å±€çŠ¶æ€
â””â”€â”€ components/
    â”œâ”€â”€ GameCanvas.tsx      # Canvas å°è£…ç»„ä»¶
    â”œâ”€â”€ AmmoBay.tsx         # å·¦ä¾§èƒŒåŒ…è£…å¤‡æ  (Dnd-kit)
    â”œâ”€â”€ HUD.tsx             # é¡¶éƒ¨çŠ¶æ€æ 
    â”œâ”€â”€ Shop.tsx            # å•†åº—ç•Œé¢
    â”œâ”€â”€ LevelUpModal.tsx    # å‡çº§å¼¹çª—
    â”œâ”€â”€ ChestOpenModal.tsx  # å®ç®±åŠ¨ç”»
    â”œâ”€â”€ GameOverScreen.tsx  # æ­»äº¡ç»“ç®—
    â””â”€â”€ ammo-bay/           # èƒŒåŒ…å­ç»„ä»¶
```
